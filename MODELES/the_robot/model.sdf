<?xml version="1.0" ?>
<sdf version="1.5">
  <model name="the_robot">

    <!-- <include>
      <uri>model://my_gripper</uri>
      <pose>1.3 0 0.1 0 0 0</pose>
    </include> -->

    <include>
      <uri>model://my_robot</uri>
      <pose>0 0 0 0 0 0</pose>
    </include>


 <link name="riser">
      <pose>1.025 0.0 0.5 0 0 0</pose>
      <!-- <inertial>
        <mass>10</mass>
      </inertial> -->
      <collision name="collision">
        <geometry>
          <box>
            <size>0.2 0.2 1.0</size>
          </box>
        </geometry>
        <surface>
          <contact>
            <ode>
              <max_vel>0.0</max_vel> <!--VALEUR PAR DEFAUT DE MAX_VEL EGALE A 0-->
            </ode>
          </contact>
        </surface>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.2 0.2 1.0</size>
          </box>
        </geometry>
      </visual>
    </link>

    <joint type="revolute" name="riser_hinge">
      <pose>1.025 0 -0.03 0 0 0</pose>
      <child>riser</child>
      <parent>mobile_base::chassis</parent>
      <axis>
        <use_parent_model_frame>true</use_parent_model_frame>
        <xyz>0 1 0</xyz>
      </axis>
    </joint>

    <joint name="chassis-riser_joint" type="fixed">
      <parent>mobile_base::chassis</parent>
      <child>riser</child>
    </joint>


    <link name="palm">
      <pose>1.175 0.0 0.1 0 0 0</pose>
      <!-- <inertial>
        <mass>0.5</mass>
      </inertial> -->
      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.2 0.1</size>
          </box>
        </geometry>
        <surface>
          <contact>
            <ode>
              <max_vel>0.0</max_vel>
            </ode>
          </contact>
        </surface>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.1 0.2 0.1</size>
          </box>
        </geometry>
      </visual>
    </link>



    <link name="left_finger">
      <pose>1.275 0.2 0.1 0 0 -0.78539</pose>
      <!-- <inertial>
        <mass>0.1</mass>
      </inertial> -->
      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.3 0.1</size>
          </box>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.1</mu>
              <mu2>0</mu2>
            </ode>
          </friction>
          <contact>
            <ode>
              <max_vel>0.0</max_vel>
            </ode>
          </contact>
        </surface>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.1 0.3 0.1</size>
          </box>
        </geometry>
      </visual>
    </link>


    <link name="left_finger_tip">
      <pose>1.511 0.3 0.1 0 0 1.5707</pose>
      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.2 0.1</size>
          </box>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>.1</mu>
              <mu2>0</mu2>
            </ode>
          </friction>
          <contact>
            <ode>
              <max_vel>0.0</max_vel>
            </ode>
          </contact>
        </surface>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.1 0.2 0.1</size>
          </box>
        </geometry>
      </visual>
    </link>
    <link name="right_finger">
      <pose>1.275 -0.2 0.1 0 0 .78539</pose>
      <!-- <inertial>
        <mass>0.1</mass>
      </inertial> -->
      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.3 0.1</size>
          </box>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.1</mu>
              <mu2>0</mu2>
            </ode>
          </friction>
          <contact>
            <ode>
              <max_vel>0.0</max_vel>
            </ode>
          </contact>
        </surface>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.1 0.3 0.1</size>
          </box>
        </geometry>
      </visual>
    </link>
    <link name="right_finger_tip">
      <pose>1.511 -0.3 0.1 0 0 1.5707</pose>
      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.2 0.1</size>
          </box>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.1</mu>
              <mu2>0</mu2>
            </ode>
          </friction>
          <contact>
            <ode>
              <max_vel>0.0</max_vel>
            </ode>
          </contact>
        </surface>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.1 0.2 0.1</size>
          </box>
        </geometry>
      </visual>
    </link>
    <joint name="palm_left_finger" type="revolute">
      <!-- <pose>1.175 -0.15 0 0 0 0</pose> -->
      <child>left_finger</child>
      <parent>palm</parent>
      <axis>
        <limit>
          <lower>-0.8</lower>
          <upper>0.8</upper>
        </limit>
        <xyz>0 0 1</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
      </axis>
    </joint>
    <joint name="left_finger_tip" type="revolute">
      <!-- <pose>1.175 0.1 0 0 0 0</pose> -->
      <child>left_finger_tip</child>
      <parent>left_finger</parent>
      <axis>
        <limit>
          <lower>-0.8</lower>
          <upper>0.8</upper>
        </limit>
        <xyz>0 0 1</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
      </axis>
    </joint>
    <joint name="palm_right_finger" type="revolute">
      <!-- <pose>1.175 0.15 0 0 0 0</pose> -->
      <child>right_finger</child>
      <parent>palm</parent>
      <axis>
        <limit>
          <lower>-0.8</lower>
          <upper>0.8</upper>
        </limit>
        <xyz>0 0 1</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
      </axis>
    </joint>
    <joint name="right_finger_tip" type="revolute">
      <!-- <pose>1.175 0.1 0 0 0 0</pose> -->
      <child>right_finger_tip</child>
      <parent>right_finger</parent>
      <axis>
        <limit>
          <lower>-0.8</lower>
          <upper>0.8</upper>
        </limit>
        <xyz>0 0 1</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
      </axis>
    </joint>
    <joint name="palm_riser" type="prismatic">
      <child>palm</child>
      <parent>riser</parent>
      <axis>
        <limit>
          <lower>0</lower>
          <upper>0.9</upper>
        </limit>
        <xyz>0 0 1</xyz>
        <use_parent_model_frame>true</use_parent_model_frame>
      </axis>
    </joint>
    <gripper name="simple_gripper">
      <grasp_check>
        <detach_steps>40</detach_steps>
        <attach_steps>20</attach_steps>
        <min_contact_count>2</min_contact_count>
      </grasp_check>
      <gripper_link>right_finger</gripper_link>
      <gripper_link>right_finger_tip</gripper_link>
      <gripper_link>left_finger</gripper_link>
      <gripper_link>left_finger_tip</gripper_link>
      <palm_link>palm</palm_link>
    </gripper>










    <link name="camera_link">
      <pose>1.0 0 1.05 0 0 0</pose>
      <!-- <inertial>
        <mass>0.1</mass>
        <inertia>
          <ixx>0.000166667</ixx>
          <iyy>0.000166667</iyy>
          <izz>0.000166667</izz>
        </inertia>
      </inertial> -->
      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.1 0.1</size>
          </box>
        </geometry>
      </collision>
      <visual name="visual">
        <geometry>
          <box>
            <size>0.1 0.1 0.1</size>
          </box>
        </geometry>
      </visual>
      <sensor name="camera" type="camera">
        <camera>
          <horizontal_fov>1.047</horizontal_fov>
          <image>
            <width>320</width>
            <height>240</height>
          </image>
          <clip>
            <near>0.1</near>
            <far>100</far>
          </clip>
        </camera>

        <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
          <alwaysOn>true</alwaysOn>
          <updateRate>0.0</updateRate>
          <cameraName>the_robot_camera/camera1</cameraName>
          <imageTopicName>image_raw</imageTopicName>
          <cameraInfoTopicName>camera_info</cameraInfoTopicName>
          <frameName>camera_link</frameName>
          <hackBaseline>0.07</hackBaseline>
        </plugin>



      </sensor>
    </link>


    <joint name="camera_joint" type="fixed">
      <child>camera_link</child>
      <parent>riser</parent>
    </joint>






    <joint name="arm_gripper_joint" type="fixed">
      <parent>mobile_base::chassis</parent>
      <child>riser</child>
    </joint>

    <!-- attach sensor to the gripper -->
    <!--<link name ="laser_link">-->
    <link name="hokuyo_link">
      <!-- <uri>model://hokuyo</uri>
      <pose>1.3 0 0.3 0 0 0</pose> -->


    <sensor type="ray" name="head_hokuyo_sensor">
      <pose>1.3 0 0.3 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>40</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>720</samples>
            <resolution>1</resolution>
            <min_angle>-1.570796</min_angle>
            <max_angle>1.570796</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.10</min>
          <max>30.0</max>
          <resolution>0.01</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <!-- Noise parameters based on published spec for Hokuyo laser
               achieving "+-30mm" accuracy at range < 10m.  A mean of 0.0m and
               stddev of 0.01m will put 99.7% of samples within 0.03m of the true
               reading. -->
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="gazebo_ros_head_hokuyo_controller" filename="libgazebo_ros_laser.so">
        <topicName>/the_robot/laser_scan</topicName>
        <frameName>hokuyo_link</frameName>
      </plugin>
    </sensor>

    </link>





    <joint name="hokuyo_joint" type="fixed">
      <child>hokuyo_link</child> <!-- <child>hokuyo::link</child> -->
      <parent>palm</parent>
    </joint>


    <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">

  <alwaysOn>true</alwaysOn>
  <updateRate>100</updateRate>
  <leftJoint>mobile_base::left_wheel_hinge</leftJoint>
  <rightJoint>mobile_base::right_wheel_hinge</rightJoint>
  <wheelSeparation>0.39</wheelSeparation>
  <wheelDiameter>0.15</wheelDiameter>
  <torque>5</torque>
  <commandTopic>cmd_vel</commandTopic>
   <odometryTopic>odom</odometryTopic>
   <odometryFrame>odom</odometryFrame>
  <robotBaseFrame>mobile_base::chassis</robotBaseFrame>
  <publishWheelTF>true</publishWheelTF>
  <publishWheelJointState>true</publishWheelJointState>
  <rosDebugLevel>na</rosDebugLevel>
  <publishOdomTF>true</publishOdomTF>
  <wheelAcceleration>10</wheelAcceleration>
  <wheelTorque>5</wheelTorque>
  <odometrySource>world</odometrySource>
  <publishTf>1</publishTf>



    </plugin>

        <!-- <link name="new_wheel">
      <pose>0.8 0.6 10.125 0 1.5707 1.5707</pose>
      <collision name="collision">
        <geometry>
          <cylinder>
            <radius>.125</radius>
            <length>.05</length>
          </cylinder>
        </geometry>
      </collision>
      <visual name="visual">
        <geometry>
          <cylinder>
            <radius>.125</radius>
            <length>.05</length>
          </cylinder>
        </geometry>
      </visual>
    </link>

    <joint type="revolute" name="new_wheel_hinge">
      <pose>0 0 -0.03 0 0 0</pose>
      <child>new_wheel</child>
      <parent>mobile_base::chassis</parent>
      <axis>
        <use_parent_model_frame>true</use_parent_model_frame>
        <xyz>0 1 0</xyz>
      </axis>
    </joint>

    <joint name="new_wheel_joint" type="fixed">
      <parent>mobile_base::chassis</parent>
      <child>new_wheel</child>
    </joint> -->


  </model>
</sdf>
